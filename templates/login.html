{% extends "base.html" %}
{% block title %}Login - Petition Tracker{% endblock %}

{% block fullpage %}
<style>
  /* ===== LOGIN PAGE: LANDING.HTML VISUAL STYLE OVERRIDE ===== */

  /* Dark navy background matching landing */
  .login-page.login-page-modern {
    background: #0A1628;
  }

  /* Replace light aurora with landing's dark glow */
  .login-page-modern .login-aurora {
    background:
      radial-gradient(ellipse 60% 50% at 20% 20%, rgba(245,166,35,0.10) 0%, transparent 70%),
      radial-gradient(ellipse 40% 60% at 80% 80%, rgba(27,50,96,0.50) 0%, transparent 70%),
      radial-gradient(ellipse 80% 80% at 50% 50%, rgba(10,22,40,1) 0%, #0A1628 100%);
    animation: none;
    filter: none;
  }

  /* Subtle dark grid */
  .login-page-modern .login-grid {
    background-image:
      linear-gradient(rgba(245,166,35,0.04) 1px, transparent 1px),
      linear-gradient(90deg, rgba(245,166,35,0.04) 1px, transparent 1px);
    opacity: 0.5;
  }

  /* Nav — match landing nav */
  .login-top-nav {
    background: rgba(10,22,40,0.80) !important;
    backdrop-filter: blur(20px) !important;
    -webkit-backdrop-filter: blur(20px) !important;
    border-bottom: 1px solid rgba(245,166,35,0.12) !important;
    box-shadow: 0 4px 24px rgba(0,0,0,0.30) !important;
  }
  .login-nav-shield {
    border-color: rgba(245,166,35,0.50);
    background: rgba(245,166,35,0.08);
  }
  .login-nav-title { color: #F5A623; }
  .login-nav-sub   { color: #8899B0; }
  .login-nav-links a:not(.login-btn-launch) { color: #8899B0; }
  .login-nav-links a:not(.login-btn-launch):hover { color: #F5A623; }
  .login-btn-launch {
    background: linear-gradient(135deg, #F5A623, #C78200);
    color: #0A1628;
    box-shadow: 0 4px 20px rgba(245,166,35,0.30);
  }
  .login-btn-launch:hover { box-shadow: 0 8px 30px rgba(245,166,35,0.50); }

  /* Shell — dark glass card */
  .login-shell {
    background: rgba(19,34,64,0.72);
    border: 1px solid rgba(245,166,35,0.12);
    box-shadow: 0 24px 64px rgba(0,0,0,0.45), inset 0 1px 0 rgba(245,166,35,0.06);
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    border-radius: 26px;
  }

  /* Panel — dark form area */
  .login-panel {
    background:
      radial-gradient(circle at -12% -8%, rgba(245,166,35,0.08), transparent 36%),
      linear-gradient(180deg, rgba(10,22,40,0.96), rgba(13,26,50,0.96));
    border-right: 1px solid rgba(245,166,35,0.08);
  }

  /* Tabs */
  .login-tabs {
    background: rgba(19,34,64,0.80);
    border: 1px solid rgba(245,166,35,0.12);
  }
  .login-tabs button   { color: #8899B0; }
  .login-tabs .is-muted { color: #4a5a78; }
  .login-tabs .is-active {
    color: #F5A623;
    background: rgba(245,166,35,0.06);
    box-shadow: inset 0 -3px 0 #F5A623;
  }

  /* Logo wrap */
  .login-logo-wrap {
    background: linear-gradient(160deg, rgba(19,34,64,0.9), rgba(10,22,40,0.9));
    border-color: rgba(245,166,35,0.30);
    box-shadow: 0 8px 24px rgba(0,0,0,0.30), 0 0 0 1px rgba(245,166,35,0.08);
  }

  /* Header text */
  .login-header h1 { color: #F0F2F5; }
  .login-subtitle  { color: #8899B0; }

  /* Form labels */
  .login-form .form-group label { color: #8899B0; }

  /* Inputs — dark with gold focus */
  .login-page-modern .login-form input {
    background: rgba(19,34,64,0.80);
    border: 1px solid rgba(245,166,35,0.14);
    color: #F0F2F5;
    border-radius: 14px;
  }
  .login-page-modern .login-form input::placeholder { color: #4a5a78; }
  .login-page-modern .login-form input:focus {
    border-color: #F5A623;
    background: rgba(19,34,64,0.96);
    box-shadow: 0 0 0 3px rgba(245,166,35,0.14);
    transform: translateY(-1px) scale(1.005);
  }

  /* Captcha */
  .login-captcha-box {
    background: rgba(10,22,40,0.90);
    border: 1px solid rgba(245,166,35,0.22);
    color: #F0F2F5;
  }
  .login-captcha-text { color: #F5A623; font-weight: 800; letter-spacing: 2px; }
  .login-captcha-refresh {
    background: rgba(245,166,35,0.08);
    border-color: rgba(245,166,35,0.25);
    color: #F5A623;
  }
  .login-captcha-refresh:hover { background: rgba(245,166,35,0.18); }

  /* Submit button — gold gradient matching landing */
  .login-page-modern .login-form .btn {
    background: linear-gradient(135deg, #F5A623, #C78200);
    color: #0A1628;
    border: none;
    box-shadow: 0 8px 28px rgba(245,166,35,0.30);
    border-radius: 14px;
    font-weight: 700;
  }
  .login-page-modern .login-form .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 14px 36px rgba(245,166,35,0.45);
  }
  .login-captcha-verify {
    background: linear-gradient(135deg, #F5A623, #C78200) !important;
    color: #0A1628 !important;
    box-shadow: 0 8px 28px rgba(245,166,35,0.30) !important;
    border-radius: 14px !important;
  }

  /* Footer */
  .login-footer { color: #8899B0; }

  /* ===== MOBILE FIXES ===== */

  /* iOS: prevent auto-zoom on input focus (font-size must be >= 16px) */
  @media (max-width: 768px) {
    .login-page-modern .login-form input {
      font-size: 16px;
    }
    /* No transform on mobile — avoids layout shift when keyboard opens */
    .login-page-modern .login-form input:focus {
      transform: none;
    }
  }

  /* Small phones: restore original 14px shell border-radius */
  @media (max-width: 640px) {
    .login-shell {
      border-radius: 14px;
    }
  }

  /* Hero side — dark matching landing */
  .login-hero {
    background:
      radial-gradient(circle at 70% 30%, rgba(255,255,255,0.04), transparent 34%),
      radial-gradient(circle at 30% 70%, rgba(245,166,35,0.12), transparent 44%),
      linear-gradient(150deg, rgba(19,34,64,0.98), rgba(10,22,40,0.99));
  }
  .login-hero::before {
    background:
      radial-gradient(circle at 62% 44%, rgba(245,166,35,0.16), transparent 58%),
      radial-gradient(circle at 76% 70%, rgba(55,95,170,0.20), transparent 48%);
  }
  .login-hero::after {
    border-color: rgba(245,166,35,0.18);
    background: linear-gradient(145deg, rgba(245,166,35,0.08), rgba(20,40,76,0.05));
  }
  .login-hero-mark {
    background: rgba(19,34,64,0.90);
    border: 1px solid rgba(245,166,35,0.35);
    box-shadow: 0 12px 28px rgba(0,0,0,0.35), 0 0 0 1px rgba(245,166,35,0.06);
  }
  .login-hero h2 { color: #F5A623; }
  .login-hero p  { color: #8899B0; }

  /* Orbit widget */
  .login-orbit {
    background:
      linear-gradient(145deg, rgba(245,166,35,0.10), rgba(19,34,64,0.60)),
      radial-gradient(circle at 20% 70%, rgba(245,166,35,0.10), transparent 44%);
    border-color: rgba(245,166,35,0.30);
  }

  /* Hero pills — landing badge style */
  .hero-pill {
    background: rgba(245,166,35,0.08);
    border: 1px solid rgba(245,166,35,0.25);
    color: #F5A623;
  }

  /* ===== LIGHT THEME RESTORE (when user toggles to light) ===== */
  html[data-theme='light'] .login-page.login-page-modern { background: #e8f0ff; }
  html[data-theme='light'] .login-page-modern .login-aurora {
    background:
      radial-gradient(circle at 18% 20%, rgba(245,166,35,0.22), transparent 34%),
      radial-gradient(circle at 78% 78%, rgba(48,91,179,0.30), transparent 34%),
      radial-gradient(circle at 86% 24%, rgba(255,213,128,0.20), transparent 30%),
      linear-gradient(145deg, #f3f7ff 0%, #e4edff 38%, #dce7ff 100%);
    animation: loginAurora 14s ease-in-out infinite alternate;
    filter: saturate(1.08);
  }
  html[data-theme='light'] .login-shell {
    background: linear-gradient(180deg, rgba(250,252,255,0.90), rgba(237,244,255,0.80));
    border-color: rgba(64,90,144,0.24);
    box-shadow: 0 28px 62px rgba(18,35,70,0.20), inset 0 1px 0 rgba(255,255,255,0.65);
  }
  html[data-theme='light'] .login-panel {
    background:
      radial-gradient(circle at -12% -8%, rgba(245,166,35,0.14), transparent 36%),
      linear-gradient(180deg, rgba(255,255,255,0.96), rgba(248,251,255,0.94));
    border-right-color: rgba(53,77,124,0.14);
  }
  html[data-theme='light'] .login-tabs { background: linear-gradient(180deg,#f4f7fe,#ebf2ff); border-color: #cfdbf4; }
  html[data-theme='light'] .login-tabs button { color: #6f84ae; }
  html[data-theme='light'] .login-tabs .is-active { color: #16366f; background: #ffffff; box-shadow: inset 0 -3px 0 #f5a623, 0 4px 14px rgba(53,83,145,0.10); }
  html[data-theme='light'] .login-logo-wrap { background: linear-gradient(160deg,#fffaf0,#f2f6ff); border-color: #e7d6ae; box-shadow: 0 12px 24px rgba(133,92,24,0.18); }
  html[data-theme='light'] .login-header h1 { color: #17356a; }
  html[data-theme='light'] .login-subtitle   { color: #5f7398; }
  html[data-theme='light'] .login-form .form-group label { color: #324f86; }
  html[data-theme='light'] .login-page-modern .login-form input { background: linear-gradient(180deg,#f9fcff,#f3f8ff); border-color: #cfdcf3; color: #17356a; }
  html[data-theme='light'] .login-page-modern .login-form input::placeholder { color: #94a8c8; }
  html[data-theme='light'] .login-captcha-box { background: linear-gradient(145deg,#132240,#0a1628); border-color: rgba(28,48,86,0.38); color: #f9fbff; }
  html[data-theme='light'] .login-captcha-text { color: #F5A623; }
  html[data-theme='light'] .login-captcha-refresh { background: #fff5e2; border-color: #e2c78f; color: #9a6200; }
  html[data-theme='light'] .login-captcha-refresh:hover { background: #ffecc6; }
  html[data-theme='light'] .login-footer { color: #5f7398; }
  html[data-theme='light'] .login-top-nav {
    background: radial-gradient(circle at 14% 50%,rgba(245,166,35,0.16),transparent 26%), linear-gradient(90deg,rgba(11,30,68,0.98),rgba(18,46,96,0.96) 42%,rgba(10,29,67,0.98)) !important;
    border-bottom-color: rgba(97,122,170,0.34) !important;
    box-shadow: 0 18px 42px rgba(10,23,49,0.38) !important;
  }
  html[data-theme='light'] .login-nav-title { color: #f5a623; }
  html[data-theme='light'] .login-nav-sub   { color: rgba(229,237,255,0.80); }
  html[data-theme='light'] .login-nav-links a:not(.login-btn-launch) { color: rgba(224,234,255,0.72); }
  html[data-theme='light'] .login-hero {
    background:
      radial-gradient(circle at 70% 30%,rgba(255,255,255,0.14),transparent 34%),
      radial-gradient(circle at 78% 74%,rgba(245,166,35,0.20),transparent 40%),
      linear-gradient(150deg,rgba(19,34,64,0.94),rgba(10,22,40,0.96));
  }
  html[data-theme='light'] .login-hero-mark { background: rgba(255,255,255,0.92); border-color: rgba(245,166,35,0.42); box-shadow: 0 14px 30px rgba(133,92,24,0.28); }
  html[data-theme='light'] .hero-pill { background: rgba(255,255,255,0.92); border-color: rgba(245,166,35,0.44); color: #8f5f00; }
  html[data-theme='light'] .login-orbit {
    background: linear-gradient(145deg,rgba(245,166,35,0.16),rgba(19,34,64,0.52)), radial-gradient(circle at 20% 70%,rgba(245,166,35,0.16),transparent 44%);
    border-color: rgba(245,166,35,0.42);
  }
</style>
<div class="login-page login-page-modern">
    <div class="login-aurora"></div>
    <div class="login-grid"></div>
    <nav class="login-top-nav" id="loginTopNav">
        <a href="{{ url_for('index') }}" class="login-nav-brand">
            <span class="login-nav-shield">
                <img src="{{ url_for('static', filename='img/nigaa-logo.svg') }}" alt="NIGAA Logo">
            </span>
            <div>
                <h1 class="login-nav-title login-brand-anim" aria-label="NIGAA">
                    <span class="brand-letter brand-n">N</span>
                    <span class="brand-letter brand-i">I</span>
                    <span class="brand-letter brand-g">G</span>
                    <span class="brand-letter brand-a">
                        A
                        <span class="brand-cap"></span>
                        <span class="brand-eye-wrap">
                            <span class="brand-eye"><span class="brand-pupil"></span></span>
                        </span>
                    </span>
                    <span class="brand-letter brand-a">
                        A
                        <span class="brand-eye-wrap">
                            <span class="brand-eye"><span class="brand-pupil"></span></span>
                        </span>
                    </span>
                </h1>
                <div class="login-nav-sub">Vigilance Portal</div>
            </div>
        </a>
        <div class="login-nav-links">
            <a href="{{ url_for('index') }}#features">Features</a>
            <a href="{{ url_for('index') }}#stats">Dashboard</a>
            <div class="lang-toggle" role="group" aria-label="Language switch">
                <button type="button" class="lang-pill" data-lang="en">EN</button>
                <button type="button" class="lang-pill" data-lang="te">తె</button>
            </div>
            <button id="themeToggle" class="theme-toggle" type="button" aria-label="Toggle night mode" aria-pressed="false" title="Toggle night mode">
                <span class="theme-toggle-icon theme-toggle-sun" aria-hidden="true">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M6.34 17.66l-1.41 1.41"/><path d="M19.07 4.93l-1.41 1.41"/></svg>
                </span>
                <span class="theme-toggle-icon theme-toggle-moon" aria-hidden="true">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"/></svg>
                </span>
            </button>
            <a href="{{ url_for('index') }}" class="login-btn-launch"><span>▶</span> Home</a>
        </div>
    </nav>
    <div class="login-shell">
        <section class="login-panel">
            <div class="login-tabs" role="tablist" aria-label="Login options">
                <button type="button" class="is-active" data-login-tab="secure" onclick="showLoginTab('secure')" data-i18n="login.tab_secure">Secure Login</button>
                <button type="button" class="is-muted" data-login-tab="recovery" onclick="showLoginTab('recovery')" data-i18n="login.tab_recovery">Recovery</button>
            </div>
            <div class="login-header">
                <div class="login-logo-wrap">
                    <img src="{{ url_for('static', filename=brand_logo_file) }}" alt="{{ brand_name }} Logo" class="login-logo-img" onerror="this.onerror=null;this.src='{{ url_for('static', filename=brand_logo_fallback) }}';">
                </div>
                <h1>{{ brand_name }}</h1>
                <p class="login-subtitle">{{ brand_subtitle }}</p>
            </div>

            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% set ns = namespace(seen=[]) %}
            {% for category, message in messages %}
            {% set key = category ~ '|' ~ message %}
            {% if key not in ns.seen %}
            <div class="flash-msg flash-{{ category }}" style="margin-bottom: 1rem;">
                <span>{{ message }}</span>
            </div>
            {% set ns.seen = ns.seen + [key] %}
            {% endif %}
            {% endfor %}
            {% endif %}
            {% endwith %}

            <form method="POST" action="{{ url_for('login') }}" class="login-form" data-login-panel="secure">
                <div class="form-group">
                    <label for="username" data-i18n="login.username">Username</label>
                    <input type="text" id="username" name="username" required autofocus
                           placeholder="Enter your username" data-i18n-placeholder="login.ph_username" value="{{ request.form.get('username', '') }}">
                </div>
                <div class="form-group">
                    <label for="password" data-i18n="login.password">Password</label>
                    <input type="password" id="password" name="password" required
                           placeholder="Enter your password" data-i18n-placeholder="login.ph_password">
                </div>
                <div class="form-group">
                    <label for="captcha_answer" data-i18n="login.security_verification">Security Verification</label>
                    <div class="login-captcha-row">
                        <div class="login-captcha-box" aria-live="polite">
                            <span class="login-captcha-text">{{ captcha_a }} + {{ captcha_b }} = ?</span>
                            <a href="{{ url_for('login', refresh_captcha='1') }}" class="login-captcha-refresh" title="Refresh captcha" aria-label="Refresh captcha">&#8635;</a>
                        </div>
                        <input type="text" id="captcha_answer" name="captcha_answer" required inputmode="numeric" pattern="[0-9]+" placeholder="Enter the CAPTCHA answer" data-i18n-placeholder="login.ph_captcha">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary btn-full login-captcha-verify">
                    <span data-i18n="login.verify_signin">Verify & Sign In</span>
                </button>
            </form>

            <form method="POST" action="{{ url_for('request_recovery') }}" class="login-form" data-login-panel="recovery" style="display:none;">
                <div class="form-group">
                    <label for="recovery_username" data-i18n="login.username">Username</label>
                    <input type="text" id="recovery_username" name="recovery_username" placeholder="Enter your username" data-i18n-placeholder="login.ph_username">
                </div>
                <div class="form-group">
                    <label for="recovery_password" data-i18n="login.new_password">New Password</label>
                    <input type="password" id="recovery_password" name="recovery_password" minlength="6" placeholder="Enter new password" data-i18n-placeholder="login.ph_new_password">
                </div>
                <div class="form-group">
                    <label for="recovery_confirm_password" data-i18n="login.confirm_new_password">Confirm New Password</label>
                    <input type="password" id="recovery_confirm_password" name="recovery_confirm_password" minlength="6" placeholder="Confirm new password" data-i18n-placeholder="login.ph_confirm_new_password">
                </div>
                <button type="submit" class="btn btn-primary btn-full" data-i18n="login.submit_recovery">Submit Recovery Request</button>
            </form>

            <div class="login-footer">
                <p>Vigilance Wing</p>
            </div>
        </section>
        <aside class="login-hero">
            <div class="login-hero-mark">
                <img src="{{ url_for('static', filename=brand_logo_file) }}" alt="{{ brand_name }} Mark" class="login-hero-logo" onerror="this.onerror=null;this.src='{{ url_for('static', filename=brand_logo_fallback) }}';">
            </div>
            <h2>Welcome to {{ brand_name }}</h2>
            <p>Secure digital vigilance workflow for officers, enquiry tracking, and action monitoring.</p>
            <div class="login-orbit">
                <span class="orbit-ring orbit-ring-a"></span>
                <span class="orbit-ring orbit-ring-b"></span>
                <span class="orbit-core"></span>
            </div>
            <div class="login-hero-pills">
                <span class="hero-pill">Realtime Tracking</span>
                <span class="hero-pill">Role Based Access</span>
                <span class="hero-pill">Secure Workflow</span>
            </div>
        </aside>
    </div>
</div>
<script>
function showLoginTab(tabName) {
    const tabs = document.querySelectorAll('.login-tabs [data-login-tab]');
    const panels = document.querySelectorAll('.login-form[data-login-panel]');
    tabs.forEach(btn => {
        const active = btn.dataset.loginTab === tabName;
        btn.classList.toggle('is-active', active);
        btn.classList.toggle('is-muted', !active);
    });
    panels.forEach(panel => {
        panel.style.display = panel.dataset.loginPanel === tabName ? '' : 'none';
    });
}

document.addEventListener('DOMContentLoaded', function () {
    showLoginTab('secure');
});
</script>
{% endblock %}




