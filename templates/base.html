<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Petition Tracker{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    {% if session.get('user_id') %}
    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-mark">
                    <img src="{{ url_for('static', filename='img/aptransco-theme-logo.svg') }}" alt="APTRANSCO Logo" class="brand-logo" onerror="this.onerror=null;this.src='{{ url_for('static', filename='img/aptransco-logo-fallback.svg') }}';">
                </div>
                <div class="logo-text">
                    <span class="logo-title">APTRANSCO</span>
                    <span class="logo-subtitle">Petition Tracker</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <a href="{{ url_for('dashboard') }}" class="nav-item {% if request.endpoint == 'dashboard' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
                    <span>Dashboard</span>
                </a>
                
                <a href="{{ url_for('petitions_list') }}" class="nav-item {% if request.endpoint in ('petitions_list', 'petition_view') %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>
                    <span>Petitions</span>
                </a>
                {% if current_user_role == 'po' %}
                <a href="{{ url_for('petitions_list', mode='direct') }}" class="nav-item {% if request.endpoint == 'petitions_list' and request.args.get('mode') == 'direct' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/><path d="M8 8h8"/><path d="M8 12h8"/><path d="M8 16h5"/></svg>
                    <span>Direct Petitions</span>
                </a>
                {% endif %}

                {% if current_user_role in ('super_admin', 'data_entry') %}
                <a href="{{ url_for('petition_new') }}" class="nav-item {% if request.endpoint == 'petition_new' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v8"/><path d="M8 12h8"/></svg>
                    <span>New Petition</span>
                </a>
                {% endif %}

                {% if current_user_role == 'super_admin' %}
                <a href="{{ url_for('users_list') }}" class="nav-item {% if request.endpoint == 'users_list' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    <span>User Management</span>
                </a>
                <a href="{{ url_for('form_management') }}" class="nav-item {% if request.endpoint == 'form_management' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 15V3"/><path d="M3 8h18"/><path d="M5 21h14"/><path d="M6 8l1 13"/><path d="M18 8l-1 13"/></svg>
                    <span>Form Management</span>
                </a>
                {% endif %}
            </nav>

            <div class="sidebar-footer">
                <div class="user-card">
                    <div class="user-avatar">{{ current_user_name[0] if current_user_name else 'U' }}</div>
                    <div class="user-info">
                        <span class="user-name">{{ current_user_name }}</span>
                        <span class="user-role">{{ role_labels.get(current_user_role, current_user_role) }}</span>
                    </div>
                </div>
                <a href="{{ url_for('logout') }}" class="logout-btn" title="Logout">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                </a>
            </div>
        </aside>
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <button class="sidebar-toggle" id="sidebarToggle" type="button" aria-label="Toggle sidebar" aria-expanded="true">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M15 18l-6-6 6-6"/></svg>
                </button>
                <h1 class="page-title">{% block page_title %}Dashboard{% endblock %}</h1>
                <div class="top-bar-right">
                    <span class="date-display">{{ now.strftime('%d %b %Y') }}</span>
                    <button id="themeToggle" class="theme-toggle" type="button" aria-label="Toggle night mode" aria-pressed="false" title="Toggle night mode">
                        <span class="theme-toggle-icon theme-toggle-sun" aria-hidden="true">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M6.34 17.66l-1.41 1.41"/><path d="M19.07 4.93l-1.41 1.41"/></svg>
                        </span>
                        <span class="theme-toggle-icon theme-toggle-moon" aria-hidden="true">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3c0 0 0 0 0 0A7 7 0 0 0 21 12.79z"/></svg>
                        </span>
                    </button>
                </div>
            </header>

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div class="flash-container">
                {% for category, message in messages %}
                <div class="flash-msg flash-{{ category }}">
                    <span>{{ message }}</span>
                    <button onclick="this.parentElement.remove()" class="flash-close">&times;</button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}

            <div class="content-area">
                {% block content %}{% endblock %}
            </div>
        </main>
    </div>
    {% else %}
        {% block fullpage %}{% endblock %}
    {% endif %}
    
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>

